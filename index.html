<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Order Board</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:20px}
h1{text-align:center}
.section{background:#fff;padding:15px;margin:15px auto;max-width:1100px;border-radius:10px}
.person{border:1px solid #ddd;border-radius:8px;padding:10px;margin:10px 0}
button{padding:6px 12px;margin:4px}
.status{font-weight:bold}
.completed{opacity:.6}
.controls{margin-top:8px}
</style>
</head>
<body>

<h1 contenteditable id="title">Family Order Board</h1>

<div class="section">
<h2>Chef Controls</h2>
<input type="password" id="pin" placeholder="Chef PIN (default 1234)">
<button onclick="unlock()">Unlock</button>
</div>

<div class="section">
<h2>Ingredients</h2>
<input id="newIng" placeholder="Add ingredient">
<button onclick="addIngredient()">Add</button>
<div id="ingredients"></div>
</div>

<div class="section">
<h2>People</h2>
<input id="newPerson" placeholder="Add person">
<button onclick="addPerson()">Add Person</button>
<div id="people"></div>
</div>

<div class="section">
<h2>Completed Orders</h2>
<div id="completed"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDC8KLBdJ_eKxmGgUxvkMYL0FTK9b3V0UU",
  authDomain: "family-order-board-e0194.firebaseapp.com",
  databaseURL: "https://family-order-board-e0194-default-rtdb.firebaseio.com",
  projectId: "family-order-board-e0194",
  storageBucket: "family-order-board-e0194.firebasestorage.app",
  messagingSenderId: "171957463704",
  appId: "1:171957463704:web:1ea720f263998104107eed"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dataRef = ref(db, "family-orders");

let unlocked=false;
let state={
 title:"Family Order Board",
 ingredients:["Beef","Chicken","Cheese","Bacon"],
 people:{}
};

function save(){ set(dataRef,state); }

onValue(dataRef,snap=>{
 if(snap.exists()) state=snap.val();
 render();
});

function unlock(){
 if(document.getElementById("pin").value==="1234"){
  unlocked=true;
  alert("Chef unlocked");
 }
}

function addIngredient(){
 if(!unlocked) return alert("Chef locked");
 const v=document.getElementById("newIng").value.trim();
 if(!v) return;
 state.ingredients.push(v);
 document.getElementById("newIng").value="";
 save();
}

function addPerson(){
 const v=document.getElementById("newPerson").value.trim();
 if(!v) return;
 const id=Date.now();
 state.people[id]={name:v,items:{},status:"Waiting",completed:false};
 document.getElementById("newPerson").value="";
 save();
}

function toggleItem(pid,ing){
 state.people[pid].items[ing]=!state.people[pid].items[ing];
 save();
}

function setStatus(pid,s){
 state.people[pid].status=s;
 if(s==="Complete") state.people[pid].completed=true;
 save();
}

function removePerson(pid){
 if(!confirm("Remove person?")) return;
 delete state.people[pid];
 save();
}

function render(){
 document.getElementById("title").innerText=state.title;

 const ingDiv=document.getElementById("ingredients");
 ingDiv.innerHTML="";
 state.ingredients.forEach(i=>{
  const d=document.createElement("div");
  d.textContent=i;
  ingDiv.appendChild(d);
 });

 const pDiv=document.getElementById("people");
 pDiv.innerHTML="";
 Object.entries(state.people).forEach(([id,p])=>{
  if(p.completed) return;
  const d=document.createElement("div");
  d.className="person";
  d.innerHTML=`<strong>${p.name}</strong>`;
  state.ingredients.forEach(i=>{
   const c=p.items[i]?"checked":"";
   d.innerHTML+=`<div><input type="checkbox" ${c} onchange="toggleItem(${id},'${i}')"> ${i}</div>`;
  });
  d.innerHTML+=`
   <div class="status">${p.status}</div>
   <div class="controls">
   <button onclick="setStatus(${id},'Waiting')">Waiting</button>
   <button onclick="setStatus(${id},'In Progress')">In Progress</button>
   <button onclick="setStatus(${id},'Complete')">Complete</button>
   <button onclick="removePerson(${id})">Remove</button>
   </div>`;
  pDiv.appendChild(d);
 });

 const cDiv=document.getElementById("completed");
 cDiv.innerHTML="";
 Object.values(state.people).forEach(p=>{
  if(p.completed) cDiv.innerHTML+=`<div class="completed">${p.name} âœ”</div>`;
 });
}

window.toggleItem=toggleItem;
window.setStatus=setStatus;
window.removePerson=removePerson;
</script>

</body>
</html>
